!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=global.window&&global.window.$?e(global.window.$):function(t){if(!t.$&&!t.fn)throw new Error("Tokenfield requires a window object with jQuery or a jQuery instance");return e(t.$||t)}:e(jQuery)}(function(p,l){"use strict";function o(t,e){var i=this;this.$element=p(t),this.textDirection=this.$element.css("direction"),this.options=p.extend(!0,{},p.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),e),this._delimiters="string"==typeof this.options.delimiter?[this.options.delimiter]:this.options.delimiter,this._triggerKeys=p.map(this._delimiters,function(t){return t.charCodeAt(0)}),this._firstDelimiter=this._delimiters[0];var n=p.inArray(" ",this._delimiters),s=p.inArray("-",this._delimiters);0<=n&&(this._delimiters[n]="\\s"),0<=s&&(delete this._delimiters[s],this._delimiters.unshift("-"));var r=["\\","$","[","{","^",".","|","?","*","+","(",")"];p.each(this._delimiters,function(t,e){0<=p.inArray(e,r)&&(i._delimiters[t]="\\"+e)});var a,o,h,e=l&&"function"==typeof l.getMatchedCSSRules?l.getMatchedCSSRules(t):null,n=t.style.width,s=this.$element.width();e&&p.each(e,function(t,e){e.style.width&&(a=e.style.width)}),t="rtl"===p("body").css("direction")?"right":"left",(e={position:this.$element.css("position")})[t]=this.$element.css(t),this.$element.data("original-styles",e).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(t,"-10000px").prop("tabindex",-1),this.$wrapper=p('<div class="tokenfield form-control" />'),this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg"),this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm"),"rtl"===this.textDirection&&this.$wrapper.addClass("rtl"),e=this.$element.prop("id")||(new Date).getTime()+""+Math.floor(100*(1+Math.random())),this.$input=p('<input type="text" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",e+"-tokenfield").prop("tabindex",this.$element.data("original-tabindex")),(e=p('label[for="'+this.$element.prop("id")+'"]')).length&&e.prop("for",this.$input.prop("id")),this.$copyHelper=p('<input type="text" />').css("position","absolute").css(t,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper),n?this.$wrapper.css("width",n):a?this.$wrapper.css("width",a):this.$element.parents(".form-inline").length&&this.$wrapper.width(s),(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length)&&this.disable(),this.$element.prop("readonly")&&this.readonly(),this.$mirror=p('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),this.$input.css("min-width",this.options.minWidth+"px"),p.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(t,e){i.$mirror[0].style[e]=i.$input.css(e)}),this.$mirror.appendTo("body"),this.$wrapper.insertBefore(this.$element),this.$element.prependTo(this.$wrapper),this.update(),this.setTokens(this.options.tokens,!1,!1),this.listen(),p.isEmptyObject(this.options.autocomplete)||(h="rtl"===this.textDirection?"right":"left",o=p.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:h+" top",at:h+" bottom",of:this.$wrapper}},this.options.autocomplete),this.$input.autocomplete(o)),p.isEmptyObject(this.options.typeahead)||(h=this.options.typeahead,o={minLength:this.options.showAutocompleteOnFocus?0:null},(h=p.isArray(h)?h:[h,h])[0]=p.extend({},o,h[0]),this.$input.typeahead.apply(this.$input,h),this.typeahead=!0),this.$element.trigger("tokenfield:initialize")}o.prototype={constructor:o,createToken:function(t,e){var i=this;if("string"==typeof t&&(t={value:t,label:t}),void 0===e&&(e=!0),t.value=p.trim(t.value),t.label=t.label&&t.label.length?p.trim(t.label):t.value,t.value.length&&t.label.length&&!(t.label.length<=this.options.minLength)&&!(this.options.limit&&this.getTokens().length>=this.options.limit)){var n=p.Event("tokenfield:createtoken",{attrs:t});if(this.$element.trigger(n),n.attrs&&!n.isDefaultPrevented()){var s=p('<div class="token" />').attr("data-value",t.value).append('<span class="token-label" />').append('<a href="#" class="close icon icon-font-cross-bold tabindex="-1"></a>');(this.$input.hasClass("tt-input")?this.$input.parent():this.$input).before(s),this.$input.css("width",this.options.minWidth+"px");var r=s.find(".token-label"),n=s.find(".close");return this.maxTokenWidth||(this.maxTokenWidth=this.$wrapper.width()-n.outerWidth()-parseInt(n.css("margin-left"),10)-parseInt(n.css("margin-right"),10)-parseInt(s.css("border-left-width"),10)-parseInt(s.css("border-right-width"),10)-parseInt(s.css("padding-left"),10)-parseInt(s.css("padding-right"),10),parseInt(r.css("border-left-width"),10),parseInt(r.css("border-right-width"),10),parseInt(r.css("padding-left"),10),parseInt(r.css("padding-right"),10),parseInt(r.css("margin-left"),10),parseInt(r.css("margin-right"),10)),r.text(t.label).css("max-width",this.maxTokenWidth),s.on("mousedown",function(t){return!i._disabled&&!i._readonly&&void(i.preventDeactivation=!0)}).on("click",function(t){return!i._disabled&&!i._readonly&&(i.preventDeactivation=!1,t.ctrlKey||t.metaKey?(t.preventDefault(),i.toggle(s)):void i.activate(s,t.shiftKey,t.shiftKey))}).on("dblclick",function(t){return!(i._disabled||i._readonly||!i.options.allowEditing)&&void i.edit(s)}),n.on("click",p.proxy(this.remove,this)),this.$element.trigger(p.Event("tokenfield:createdtoken",{attrs:t,relatedTarget:s.get(0)})),e&&this.$element.val(this.getTokensList()).trigger(p.Event("change",{initiator:"tokenfield"})),this.update(),this.$element.get(0)}}},setTokens:function(t,e,i){if(t){e||this.$wrapper.find(".token").remove(),void 0===i&&(i=!0),"string"==typeof t&&(t=this._delimiters.length?t.split(new RegExp("["+this._delimiters.join("")+"]")):[t]);var n=this;return p.each(t,function(t,e){n.createToken(e,i)}),this.$element.get(0)}},getTokenData:function(t){t=t.map(function(){var t=p(this);return{value:t.attr("data-value"),label:t.find(".token-label").text()}}).get();return 1==t.length&&(t=t[0]),t},getTokens:function(t){var e=this,i=[],t=t?".active":"";return this.$wrapper.find(".token"+t).each(function(){i.push(e.getTokenData(p(this)))}),i},getTokensList:function(t,e,i){t=(t=t||this._firstDelimiter)+((e=null!=e?e:this.options.beautify)&&" "!==t?" ":"");return p.map(this.getTokens(i),function(t){return t.value}).join(t)},getInput:function(){return this.$input.val()},listen:function(){var n=this;this.$element.on("change",p.proxy(this.change,this)),this.$wrapper.on("mousedown",p.proxy(this.focusInput,this)),this.$input.on("focus",p.proxy(this.focus,this)).on("blur",p.proxy(this.blur,this)).on("paste",p.proxy(this.paste,this)).on("keydown",p.proxy(this.keydown,this)).on("keypress",p.proxy(this.keypress,this)).on("keyup",p.proxy(this.keyup,this)),this.$copyHelper.on("focus",p.proxy(this.focus,this)).on("blur",p.proxy(this.blur,this)).on("keydown",p.proxy(this.keydown,this)).on("keyup",p.proxy(this.keyup,this)),this.$input.on("keypress",p.proxy(this.update,this)).on("keyup",p.proxy(this.update,this)),this.$input.on("autocompletecreate",function(){var t=p(this).data("ui-autocomplete").menu.element,e=n.$wrapper.outerWidth()-parseInt(t.css("border-left-width"),10)-parseInt(t.css("border-right-width"),10);t.css("min-width",e+"px")}).on("autocompleteselect",function(t,e){return n.createToken(e.item)&&(n.$input.val(""),n.$input.data("edit")&&n.unedit(!0)),!1}).on("typeahead:selected typeahead:autocompleted",function(t,e,i){n.createToken(e)&&(n.$input.typeahead("val",""),n.$input.data("edit")&&n.unedit(!0))}),p(l).on("resize",p.proxy(this.update,this))},keydown:function(i){if(this.focused){var n=this;switch(i.keyCode){case 8:if(!this.$input.is(document.activeElement))break;this.lastInputValue=this.$input.val();break;case 37:t("rtl"===this.textDirection?"next":"prev");break;case 38:e("prev");break;case 39:t("rtl"===this.textDirection?"prev":"next");break;case 40:e("next");break;case 65:if(0<this.$input.val().length||!i.ctrlKey&&!i.metaKey)break;this.activateAll(),i.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus)").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val().length)break;if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit"))return this.createTokensFromInput(i,this.$input.data("edit"));if(13===i.keyCode){if(!this.$copyHelper.is(document.activeElement)||1!==this.$wrapper.find(".token.active").length)break;if(!n.options.allowEditing)break;this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=i.keyCode}function t(t){var e;n.$input.is(document.activeElement)?0<n.$input.val().length||(t+="All",(e=(n.$input.hasClass("tt-input")?n.$input.parent():n.$input)[t](".token:first")).length&&(n.preventInputFocus=!0,n.preventDeactivation=!0,n.activate(e),i.preventDefault())):(n[t](i.shiftKey),i.preventDefault())}function e(t){if(i.shiftKey){if(n.$input.is(document.activeElement)){if(0<n.$input.val().length)return;var e=(n.$input.hasClass("tt-input")?n.$input.parent():n.$input)[t+"All"](".token:first");if(!e.length)return;n.activate(e)}e="prev"===t?"next":"prev",t="prev"===t?"first":"last";n.firstActiveToken[e+"All"](".token").each(function(){n.deactivate(p(this))}),n.activate(n.$wrapper.find(".token:"+t),!0,!0),i.preventDefault()}}},keypress:function(t){if(this.lastKeyPressCode=t.keyCode,this.lastKeyPressCharCode=t.charCode,-1!==p.inArray(t.charCode,this._triggerKeys)&&this.$input.is(document.activeElement))return this.$input.val()&&this.createTokensFromInput(t),!1},keyup:function(t){if(this.preventInputFocus=!1,this.focused){switch(t.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&8===this.lastKeyDown)break;this.preventDeactivation=!0;var e=(this.$input.hasClass("tt-input")?this.$input.parent():this.$input).prevAll(".token:first");if(!e.length)break;this.activate(e)}else this.remove(t);break;case 46:this.remove(t,"next")}this.lastKeyUp=t.keyCode}},focus:function(t){this.focused=!0,this.$wrapper.addClass("focus"),this.$input.is(document.activeElement)&&(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null,this.options.showAutocompleteOnFocus&&this.search())},blur:function(t){this.focused=!1,this.$wrapper.removeClass("focus"),this.preventDeactivation||this.$element.is(document.activeElement)||(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null),!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)&&this.createTokensFromInput(t),this.preventDeactivation=!1,this.preventCreateTokens=!1},paste:function(t){var e=this;setTimeout(function(){e.createTokensFromInput(t)},1)},change:function(t){"tokenfield"!==t.initiator&&this.setTokens(this.$element.val())},createTokensFromInput:function(t,e){if(!(this.$input.val().length<this.options.minLength)){var i=this.getTokensList();return(this.setTokens(this.$input.val(),!0),i==this.getTokensList()&&this.$input.val().length)?!1:(this.$input.hasClass("tt-input")?this.$input.typeahead("val",""):this.$input.val(""),this.$input.data("edit")&&this.unedit(e),!1)}},next:function(t){if(t){var e=this.$wrapper.find(".active:first");if(!(!e||!this.$firstActiveToken)&&e.index()<this.$firstActiveToken.index())return this.deactivate(e)}e=this.$wrapper.find(".active:last").nextAll(".token:first");e.length?this.activate(e,t):this.$input.focus()},prev:function(t){if(t){var e=this.$wrapper.find(".active:last");if(!(!e||!this.$firstActiveToken)&&e.index()>this.$firstActiveToken.index())return this.deactivate(e)}e=this.$wrapper.find(".active:first").prevAll(".token:first");e.length||(e=this.$wrapper.find(".token:first")),e.length||t?this.activate(e,t):this.$input.focus()},activate:function(t,e,i,n){var s;t&&(void 0===n&&(n=!0),i&&(e=!0),this.$copyHelper.focus(),e||(this.$wrapper.find(".active").removeClass("active"),n?this.$firstActiveToken=t:delete this.$firstActiveToken),i&&this.$firstActiveToken&&(n=this.$firstActiveToken.index()-2,i=t.index()-2,(s=this).$wrapper.find(".token").slice(Math.min(n,i)+1,Math.max(n,i)).each(function(){s.activate(p(this),!0)})),t.addClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},activateAll:function(){var e=this;this.$wrapper.find(".token").each(function(t){e.activate(p(this),0!==t,!1,!1)})},deactivate:function(t){t&&(t.removeClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},toggle:function(t){t&&(t.toggleClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},edit:function(t){var e,i,n,s;t&&(i={attrs:e={value:t.data("value"),label:t.find(".token-label").text()},relatedTarget:t.get(0)},s=p.Event("tokenfield:edittoken",i),this.$element.trigger(s),s.isDefaultPrevented()||(t.find(".token-label").text(e.value),n=t.outerWidth(),s=this.$input.hasClass("tt-input")?this.$input.parent():this.$input,t.replaceWith(s),this.preventCreateTokens=!0,this.$input.val(e.value).select().data("edit",!0).width(n),this.update(),this.$element.trigger(p.Event("tokenfield:editedtoken",i))))},unedit:function(t){var e;(this.$input.hasClass("tt-input")?this.$input.parent():this.$input).appendTo(this.$wrapper),this.$input.data("edit",!1),this.$mirror.text(""),this.update(),t&&(e=this,setTimeout(function(){e.$input.focus()},1))},remove:function(t,e){var i,n,s;this.$input.is(document.activeElement)||this._disabled||this._readonly||(i="click"===t.type?p(t.target).closest(".token"):this.$wrapper.find(".token.active"),"click"!==t.type&&(this[e=e||"prev"](),"prev"===e&&(n=0===i.first().prevAll(".token:first").length)),s={attrs:this.getTokenData(i),relatedTarget:i.get(0)},e=p.Event("tokenfield:removetoken",s),this.$element.trigger(e),e.isDefaultPrevented()||(e=p.Event("tokenfield:removedtoken",s),s=p.Event("change",{initiator:"tokenfield"}),i.remove(),this.$element.val(this.getTokensList()).trigger(e).trigger(s),this.$wrapper.find(".token").length&&"click"!==t.type&&!n||this.$input.focus(),this.$input.css("width",this.options.minWidth+"px"),this.update(),t.preventDefault(),t.stopPropagation()))},update:function(t){var e=this.$input.val(),i=parseInt(this.$input.css("padding-left"),10)+parseInt(this.$input.css("padding-right"),10);if(this.$input.data("edit")){if((e=e||this.$input.prop("placeholder"))!==this.$mirror.text()){this.$mirror.text(e);e=this.$mirror.width()+10;if(e>this.$wrapper.width())return this.$input.width(this.$wrapper.width());this.$input.width(e)}}else{if(this.$input.css("width",this.options.minWidth+"px"),"rtl"===this.textDirection)return this.$input.width(this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-i-1);this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-i)}},focusInput:function(t){var e;p(t.target).closest(".token").length||p(t.target).closest(".token-input").length||p(t.target).closest(".tt-dropdown-menu").length||(e=this,setTimeout(function(){e.$input.focus()},0))},search:function(){this.$input.data("ui-autocomplete")&&this.$input.autocomplete("search")},disable:function(){this.setProperty("disabled",!0)},enable:function(){this.setProperty("disabled",!1)},readonly:function(){this.setProperty("readonly",!0)},writeable:function(){this.setProperty("readonly",!1)},setProperty:function(t,e){this["_"+t]=e,this.$input.prop(t,e),this.$element.prop(t,e),this.$wrapper[e?"addClass":"removeClass"](t)},destroy:function(){this.$element.val(this.getTokensList()),this.$element.css(this.$element.data("original-styles")),this.$element.prop("tabindex",this.$element.data("original-tabindex"));var t=p('label[for="'+this.$input.prop("id")+'"]');return t.length&&t.prop("for",this.$element.prop("id")),this.$element.insertBefore(this.$wrapper),this.$element.removeData("original-styles").removeData("original-tabindex").removeData("bs.tokenfield"),this.$wrapper.remove(),this.$element}};var t=p.fn.tokenfield;return p.fn.tokenfield=function(n,s){var r,a=[];Array.prototype.push.apply(a,arguments);var t=this.each(function(){var t=p(this),e=t.data("bs.tokenfield"),i="object"==typeof n&&n;"string"==typeof n&&e&&e[n]?(a.shift(),r=e[n].apply(e,a)):e||"string"==typeof n||s||t.data("bs.tokenfield",e=new o(this,i))});return void 0!==r?r:t},p.fn.tokenfield.defaults={minWidth:60,minLength:0,allowEditing:!0,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1,delimiter:",",beautify:!0},p.fn.tokenfield.Constructor=o,p.fn.tokenfield.noConflict=function(){return p.fn.tokenfield=t,this},o});